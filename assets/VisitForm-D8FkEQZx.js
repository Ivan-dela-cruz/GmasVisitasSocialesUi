import{g as S,R as V,h as I,r as F,j as e,G as s,a as h,F as T,k as w,l as j,S as k,m as f,o as i}from"./index-DlGxA0AR.js";import{u as E,C as u}from"./index.esm-DuBBEoLH.js";import{b as R,i as z}from"./visits-DCe-1QN_.js";import{u as A}from"./useTabStyles-RXA9q_xN.js";import{T as g}from"./TextField-Dbihm-yT.js";import{I as B}from"./InputLabel-CAS4qYAm.js";import{C as G}from"./CircularProgress-9Q1cfhaT.js";const L=({visit:r=null,isEdit:n=!1})=>{const m=S(),{tabPanelStyles:b}=A(),[l,d]=V.useState(!1),{selectedCompany:o}=I(),{control:c,handleSubmit:v,reset:x,formState:{errors:p}}=E({defaultValues:{title:"",observation:"",status:!0}});F.useEffect(()=>{r&&n&&x({title:r.title||"",observation:r.observation||"",status:r.status??!0})},[r,n,x]);const y=async t=>{if(!o){i({open:!0,message:"Debe seleccionar una empresa",variant:"alert",alert:{color:"warning"}});return}d(!0);try{const a={...t,idCompany:o.companyId};n&&r?(await R({...a,id:r.id}),i({open:!0,message:"Visita actualizada exitosamente",variant:"alert",alert:{color:"success"}})):(await z(a),i({open:!0,message:"Visita creada exitosamente",variant:"alert",alert:{color:"success"}})),m("/apps/visits/list")}catch(a){i({open:!0,message:a.message||"Error al guardar la visita",variant:"alert",alert:{color:"error"}})}finally{d(!1)}},C=()=>{m("/apps/visits/list")};return e.jsx("form",{onSubmit:v(y),style:{...b,paddingLeft:"2rem",paddingRight:"2rem",paddingBottom:"2rem"},children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsxs(h,{variant:"h5",gutterBottom:!0,children:["Información de la ",n?"Visita":"Nueva Visita"]})}),o&&e.jsx(s,{item:!0,xs:12,children:e.jsxs(h,{variant:"body2",color:"text.secondary",children:["Empresa: ",e.jsx("strong",{children:o.companyName})," (",o.companyCode,")"]})}),e.jsx(s,{item:!0,xs:12,sm:8,children:e.jsx(u,{name:"title",control:c,rules:{required:"El título es requerido"},render:({field:t})=>{var a;return e.jsx(g,{...t,fullWidth:!0,label:"Título *",error:!!p.title,helperText:(a=p.title)==null?void 0:a.message})}})}),e.jsx(s,{item:!0,xs:12,sm:4,children:e.jsx(u,{name:"status",control:c,render:({field:t})=>e.jsxs(T,{fullWidth:!0,children:[e.jsx(B,{children:"Estado"}),e.jsxs(w,{...t,label:"Estado",value:t.value?"true":"false",onChange:a=>t.onChange(a.target.value==="true"),children:[e.jsx(j,{value:"true",children:"Activo"}),e.jsx(j,{value:"false",children:"Inactivo"})]})]})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(u,{name:"observation",control:c,render:({field:t})=>e.jsx(g,{...t,fullWidth:!0,label:"Observación",multiline:!0,rows:4,placeholder:"Ingrese observaciones sobre la visita"})})}),e.jsx(s,{item:!0,xs:12,children:e.jsxs(k,{direction:"row",spacing:2,justifyContent:"flex-end",sx:{mt:3},children:[e.jsx(f,{variant:"outlined",color:"secondary",onClick:C,disabled:l,children:"Cancelar"}),e.jsx(f,{variant:"contained",type:"submit",disabled:l||!o,children:l?e.jsx(G,{size:24}):n?"Actualizar":"Guardar"})]})})]})})},$=L;export{$ as V};
