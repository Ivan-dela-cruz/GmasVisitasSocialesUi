import{j as i,a as g,f as o,C as m,S as F,I as u,g as k,h as A,r as n,o as b,A as D,M as C}from"./index-DlGxA0AR.js";import{B as E}from"./index-7Qti63TH.js";import{u as I,d as V}from"./visits-DCe-1QN_.js";import{u as z,C as T}from"./useConfirmDialog-B4uIsMqU.js";import{C as v}from"./Checkbox-CdHpUIEu.js";import{D as K}from"./DocumentText-DdRcliev.js";import{E as N}from"./Eye-BA6JAuf4.js";import{E as P}from"./Edit-DvqEbTVR.js";import{T as w}from"./Trash-BXUkiIWs.js";import"./ArrowLeft-DgXiCSs-.js";import"./TextField-Dbihm-yT.js";import"./InputLabel-CAS4qYAm.js";import"./FormHelperText-BjerNUfA.js";import"./TableDocument-DWQb3OC6.js";import"./index-ByAXKYUS.js";import"./getImageUrl-uZoa92S7.js";const B=({onEdit:s,onDelete:a,onView:c,onViewDetails:d}={})=>[{id:"select",header:({table:e})=>i.jsx(v,{checked:e.getIsAllPageRowsSelected(),indeterminate:e.getIsSomePageRowsSelected(),onChange:t=>{e.getToggleAllPageRowsSelectedHandler()(t)},sx:{padding:0}}),cell:({row:e})=>i.jsx(v,{checked:e.getIsSelected(),disabled:!e.getCanSelect(),onChange:t=>{e.getToggleSelectedHandler()(t)},sx:{padding:0}}),enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:50,meta:{skipFilter:!0}},{accessorKey:"id",header:"ID",cell:({getValue:e})=>e()||"N/A",enableColumnFilter:!0,size:320,filterFn:"includesString",defaultIsVisible:!1,toolTip:"ID de la visita"},{accessorKey:"title",header:"Título",cell:({getValue:e})=>{const t=e();return i.jsx(g,{variant:"subtitle2",align:"left",children:t||"Sin título"})},enableColumnFilter:!0,size:250,filterFn:"includesString"},{accessorKey:"observation",header:"Observación",cell:({getValue:e})=>{const t=e();return i.jsx(o,{title:t||"Sin observación",children:i.jsx(g,{variant:"body2",align:"left",noWrap:!0,sx:{maxWidth:300},children:t||"Sin observación"})})},enableColumnFilter:!0,size:300,filterFn:"includesString"},{accessorKey:"createdAt",header:"Fecha de Creación",cell:({getValue:e})=>{const t=e();return t?new Date(t).toLocaleDateString("es-ES"):"N/A"},enableColumnFilter:!1,size:150,defaultIsVisible:!1},{accessorKey:"updatedAt",header:"Última Actualización",cell:({getValue:e})=>{const t=e();return t?new Date(t).toLocaleDateString("es-ES"):"N/A"},enableColumnFilter:!1,size:150},{accessorKey:"userUpdatedBy",header:"Actualizado por",cell:({getValue:e})=>e()||"N/A",enableColumnFilter:!0,size:120,filterFn:"includesString",defaultIsVisible:!1,meta:{align:"left"}},{accessorKey:"userCreatedBy",header:"Creado por",cell:({getValue:e})=>e()||"N/A",enableColumnFilter:!0,size:120,filterFn:"includesString",defaultIsVisible:!1},{accessorKey:"status",header:"Estado",cell:e=>{const t=e.getValue();return t===!0||t==="active"||t===1?i.jsx(m,{color:"success",label:"Activo",size:"small",variant:"light"}):t===!1||t==="inactive"||t===0?i.jsx(m,{color:"error",label:"Inactivo",size:"small",variant:"light"}):i.jsx(m,{color:"info",label:"Desconocido",size:"small",variant:"light"})},meta:{align:"center"},enableColumnFilter:!1,size:100},{id:"actions",header:"Acciones",accessorKey:"actions",cell:({row:e})=>{const t=e.original;return i.jsxs(F,{direction:"row",alignItems:"center",justifyContent:"center",spacing:0,children:[d&&i.jsx(o,{title:"Ver Detalles",children:i.jsx(u,{color:"info",onClick:r=>{r.stopPropagation(),d(t)},children:i.jsx(K,{})})}),c&&i.jsx(o,{title:"Ver",children:i.jsx(u,{color:"secondary",onClick:r=>{r.stopPropagation(),c(t)},children:i.jsx(N,{})})}),s&&i.jsx(o,{title:"Editar",children:i.jsx(u,{color:"primary",onClick:r=>{r.stopPropagation(),s(t)},children:i.jsx(P,{})})}),a&&i.jsx(o,{title:"Eliminar",children:i.jsx(u,{color:"error",onClick:r=>{r.stopPropagation(),a(t)},children:i.jsx(w,{})})})]})},enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:120,meta:{skipFilter:!0,align:"center"}}];function ee(){const s=k(),{selectedCompany:a}=A(),{visitsLoading:c,visits:d}=I(a==null?void 0:a.companyId),{dialogState:e,openDialog:t,closeDialog:r}=z(),p=n.useCallback(()=>{s("/apps/visits/create")},[s]),f=n.useCallback(l=>{s(`/apps/visits/edit/${l.id}`)},[s]),h=n.useCallback(async l=>{t({title:"Eliminar Visita",message:`¿Está seguro de eliminar la visita "${l.title}"?`,severity:"error",confirmText:"Eliminar",onConfirm:async()=>{try{await V(l.id,a==null?void 0:a.companyId),b({open:!0,message:"Visita eliminada exitosamente",variant:"alert",alert:{color:"success"}})}catch(y){b({open:!0,message:y.message||"Error al eliminar la visita",variant:"alert",alert:{color:"error"}})}}})},[a,t]),x=n.useCallback(l=>{s(`/apps/visits/${l.id}/profile/details`)},[s]),j=n.useMemo(()=>[{label:"Nueva Visita",icon:i.jsx(D,{}),onClick:p,color:"primary",variant:"contained"}],[p]),S=n.useMemo(()=>B({onEdit:f,onDelete:h,onViewDetails:x}),[f,h,x]);return c?i.jsx(C,{children:i.jsx(g,{variant:"h5",align:"center",children:"Cargando visitas..."})}):i.jsxs(C,{content:!1,children:[i.jsx(E,{tableId:"visits-table",title:"Lista de Visitas",columns:S,data:d,enableRowSelection:!0,filterOnHeaderVisible:!0,tableNowrap:!0,actions:j}),i.jsx(T,{open:e.open,title:e.title,message:e.message,onConfirm:e.onConfirm,onCancel:r,confirmText:e.confirmText,cancelText:e.cancelText,severity:e.severity})]})}export{ee as default};
